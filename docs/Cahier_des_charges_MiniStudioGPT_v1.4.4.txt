CAHIER DES CHARGES â€“ MINISTUDIOGPT v1.4.4
CompatibilitÃ© complÃ¨te GPT / Apply-Code + Robustesse Builder
Date : 1er novembre 2025
Auteur : Code GPT + Rachid Hammami
Version cible : v1.4.4 Stable

--------------------------------------
ðŸŽ¯ OBJECTIF GLOBAL
Rendre MiniStudioGPT totalement compatible avec les appels extÃ©rieurs GPT via tunnel Cloudflare
ou domaine ministudio.store, en corrigeant les erreurs dâ€™apply-code rencontrÃ©es en v1.4.3.

PrioritÃ©s :
1. TolÃ©rance accrue sur les chemins de fichiers.
2. CrÃ©ation automatique de fonction manquante.
3. Messages dâ€™erreurs clairs et exploitables.
4. Journalisation enrichie.
5. Maintien compatibilitÃ© tests v1.4.3.

--------------------------------------
âš™ï¸ PARTIE 1 â€“ ARCHITECTURE
Structure inchangÃ©e :
MiniStudio/
â”œâ”€â”€ builder_core.py
â”œâ”€â”€ fastapi_app/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ endpoints_project.py
â”‚   â””â”€â”€ test_patch_target.py
â”œâ”€â”€ memory/
â”‚   â”œâ”€â”€ memoire.json
â”‚   â”œâ”€â”€ session.log
â”‚   â””â”€â”€ session_local_fallback.log
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_apply_code.py
â”‚   â”œâ”€â”€ test_apply_code_async.py
â”‚   â””â”€â”€ test_collab_flow.py
â””â”€â”€ docker-compose.yml

--------------------------------------
âš™ï¸ PARTIE 2 â€“ Ã‰VOLUTIONS TECHNIQUES

1. Assouplissement du contrÃ´le de chemin
   - Normaliser / ajouter automatiquement './' si absent.
   - Refuser seulement hors ./fastapi_app/.
   - Journaliser le refus clair.

2. CrÃ©ation automatique de fonction manquante
   - Ajouter le code Ã  la fin du fichier si fonction absente.
   - VÃ©rifier syntaxe avec py_compile.
   - Restaurer backup en cas dâ€™erreur.

3. Gestion dâ€™erreurs enrichie /project/apply-code
   - 400 : chemin non autorisÃ©.
   - 404 : fichier introuvable.
   - 409 : fonction absente.
   - 500 : erreur interne.
   - Toujours renvoyer JSON clair avec func_name et server_version.

4. CompatibilitÃ© GPT
   - Accepter chemins avec ou sans './'.
   - TolÃ©rer retours de ligne Unix/Windows.
   - RÃ©ponses JSON cohÃ©rentes.
   - Champ server_version=v1.4.4 dans chaque rÃ©ponse.

5. Journalisation enrichie
   - PrÃ©fixer logs par [MiniStudioGPT v1.4.4].
   - Ajouter session_audit.log avec Ã©vÃ©nements critiques.

--------------------------------------
ðŸ§ª PARTIE 3 â€“ TESTS

Tests unitaires : test_apply_code.py, test_apply_code_async.py, test_collab_flow.py
Tests GPT distants : appel via https://ministudio.store
RÃ©sultat attendu : 200 ou 409 JSON interprÃ©table, aucun timeout.

--------------------------------------
ðŸ” PARTIE 4 â€“ SÃ‰CURITÃ‰
- Refus fichiers sensibles (.env, .git, docker-compose, secret, token, system32).
- Fichiers modifiables uniquement sous ./fastapi_app/.
- Journalisation de tout refus.

--------------------------------------
ðŸ§± PARTIE 5 â€“ LIVRABLES
builder_core.py -> mis Ã  jour
endpoints_project.py -> messages enrichis
test_apply_code.py -> mise Ã  jour crÃ©ation fonction
session_audit.log -> nouveau
Session_Report_v1.4.4.md -> nouveau

--------------------------------------
ðŸ§­ PARTIE 6 â€“ VALIDATION
CritÃ¨res :
1. Apply-code local : pytest 100 %.
2. Apply-code distant : rÃ©ponse claire.
3. CrÃ©ation fonction absente : OK.
4. Rollback valide : OK.
5. Logs : horodatÃ©s.
6. Docker/Cloudflare : stable.

--------------------------------------
ðŸ§© PARTIE 7 â€“ PRÃ‰PARATION v1.5
- Ajout Cortex Layer (analyse vectorielle du code).
- Base cortex.db pour embeddings des fonctions.

--------------------------------------
âœ… CONCLUSION
MiniStudioGPT v1.4.4 = version tolÃ©rante et intelligente.
Acceptation des chemins variÃ©s, crÃ©ation automatique des fonctions, messages explicites,
collaboration IA â†” API fluide et robuste.
