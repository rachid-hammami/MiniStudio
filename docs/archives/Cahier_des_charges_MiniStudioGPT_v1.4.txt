# üß† Cahier des charges complet ‚Äì MiniStudioGPT v1.4 (Interface + Builder Core)
## Fusion des cahiers MiniStudioGPT_v1.4 et builder_core_v1.4

---

## üéØ Objectif global
Cr√©er une version compl√®te et coh√©rente de **MiniStudioGPT v1.4**, combinant :
- Une **interface collaborative IA ‚Üî humain** ;
- Un **moteur interne de modification et de r√©paration de code** ;
- Une **m√©moire persistante** tra√ßant toutes les actions ;
- Des **modes de travail adaptatifs** (collaboratif, automatique, brouillon).

---

# üîπ Partie 1 ‚Äî Interface collaborative IA ‚Üî Humain

### üéØ Objectif
Transformer MiniStudioGPT en un **copilote de d√©veloppement** capable de proposer, √©crire et modifier du code tout en gardant l‚Äôhumain au centre des d√©cisions.

### Modes d‚Äôintervention

| Mode | Nom interne | Description | Comportement |
|------|--------------|--------------|---------------|
| üëÅÔ∏è Collaboratif | `review` | Propose du code √† l‚Äôutilisateur et attend validation. | Le code est affich√© puis √©crit uniquement apr√®s accord. |
| ‚ö° Automatique | `auto` | √âcrit imm√©diatement dans les fichiers sans affichage pr√©alable. | Le code est directement enregistr√© via `/project/write`. |
| üí¨ Brouillon | `draft` | Sauvegarde la proposition sans modifier les fichiers. | Le code est stock√© dans `/memory/drafts/`. |

L‚Äôutilisateur peut basculer librement entre les modes :  
> ‚ÄúPasse en mode auto.‚Äù / ‚ÄúRepasse en mode collaboratif.‚Äù

---

### Endpoints API (interface)

| M√©thode | Route | Description |
|----------|--------|-------------|
| `POST` | `/project/propose` | Enregistre une proposition de code sans √©criture imm√©diate. |
| `POST` | `/project/apply` | Applique ou rejette une proposition enregistr√©e. |
| `GET` | `/project/full-access` | Liste compl√®te du projet. |
| `GET` | `/project/memory/status` | V√©rifie les fichiers m√©moire. |
| `GET` | `/project/snapshot` | R√©cup√®re l‚Äô√©tat complet de la m√©moire. |

---

### Gestion m√©moire et fichiers
Structure :
```
/app/
 ‚îú‚îÄ‚îÄ fastapi_app/
 ‚îÇ    ‚îú‚îÄ‚îÄ main.py
 ‚îÇ    ‚îî‚îÄ‚îÄ endpoints_project.py
 ‚îú‚îÄ‚îÄ memory/
 ‚îÇ    ‚îú‚îÄ‚îÄ memoire.json
 ‚îÇ    ‚îú‚îÄ‚îÄ session.log
 ‚îÇ    ‚îú‚îÄ‚îÄ project_map.json
 ‚îÇ    ‚îî‚îÄ‚îÄ drafts/
 ‚îÇ         ‚îú‚îÄ‚îÄ main_draft_20251030.json
 ‚îÇ         ‚îî‚îÄ‚îÄ endpoints_draft_20251030.json
```

R√®gles :
- Brouillons valides 24h maximum.  
- Tous les logs sont append-only.  
- Les r√©sum√©s de collaboration sont ajout√©s √† `memoire.json`.  

---

### Interaction IA ‚Üî Humain

#### Mode collaboratif :
1. Lecture du fichier.  
2. R√©daction d‚Äôune proposition Python claire.  
3. Affichage √† l‚Äôutilisateur ‚Üí validation demand√©e.  
4. Si valid√© ‚Üí `/project/write`, sinon `/project/propose` (brouillon).  

#### Mode automatique :
1. Lecture ‚Üí g√©n√©ration ‚Üí √©criture directe (`/project/write`).  
2. Confirmation via message :  
   > ‚Äú‚úÖ Route /hello ajout√©e dans fastapi_app/main.py‚Äù  

#### Mode brouillon :
1. Sauvegarde de la proposition dans `/memory/drafts/`.  
2. L‚Äôutilisateur peut valider plus tard avec `/project/apply`.

---

### S√©curit√© et int√©grit√©
- Aucun code n‚Äôest ex√©cut√© automatiquement.  
- √âcriture limit√©e au dossier `/app/`.  
- Fichiers valides uniquement (.py, .js, .html, .txt).  
- Rejets automatiques en cas d‚Äôerreurs ou de conflits (422).

---

# üîπ Partie 2 ‚Äî Moteur interne : `builder_core_v1.4.py`

### üéØ Objectif
Donner √† MiniStudioGPT la capacit√© technique de **modifier le code Python proprement**, sans r√©√©crire tout le fichier, avec v√©rification et reprise automatique.

### Fonctions principales
| Fonction | R√¥le |
|-----------|------|
| `auto_patch_function(filepath, func_name, new_code)` | Remplace une fonction sp√©cifique dans un fichier Python. |
| `auto_repair_file(filepath)` | V√©rifie et corrige la syntaxe du fichier modifi√©. |
| `session_recovery()` | R√©cup√®re et relance les op√©rations incompl√®tes. |

---

### D√©tails des fonctions

#### 1Ô∏è‚É£ `auto_patch_function()`
Lit un fichier Python, trouve la fonction cible et remplace uniquement son contenu.  
- Sauvegarde un backup avant √©criture.  
- R√©√©crit le fichier avec le nouveau code.  
- Appelle `auto_repair_file()` pour validation.  

Retourne `True` si la modification r√©ussit, `False` sinon.

#### 2Ô∏è‚É£ `auto_repair_file()`
V√©rifie la syntaxe du fichier (`ast.parse()` ou `py_compile`).  
- Corrige les erreurs simples (indentation, parenth√®ses).  
- Si √©chec ‚Üí restaure le backup.  
- Logue l‚Äôop√©ration dans `session.log`.

#### 3Ô∏è‚É£ `session_recovery()`
Relit `session.log` pour d√©tecter des patchs inachev√©s.  
- Si une op√©ration est marqu√©e ‚Äúpending‚Äù, restaure ou relance l‚Äôaction.  

---

### S√©curit√©
- Backup syst√©matique avant modification.  
- Aucune ex√©cution automatique du code.  
- Acc√®s limit√© √† `/app/fastapi_app/`.  
- Rejet des extensions non autoris√©es.

---

### Int√©gration compl√®te (IA ‚Üî moteur)
1. En mode `review`, l‚ÄôIA r√©dige et attend ton accord.  
2. En cas de validation :  
   - `/project/write` ‚Üí `builder_core_v1.4.auto_patch_function()` est appel√©.  
3. Le moteur √©crit et v√©rifie le code.  
4. En cas d‚Äôerreur, `auto_repair_file()` ou `session_recovery()` interviennent.  
5. Tout est consign√© dans `session.log` et `memoire.json`.

---

## ‚úÖ R√©sultat attendu
Apr√®s la version **v1.4 compl√®te** :
- Le GPT agit comme un **vrai d√©veloppeur supervis√©**.  
- Le code Python est modifi√© proprement, sauvegard√©, v√©rifi√© et tra√ßable.  
- L‚Äôhumain conserve toujours le **dernier mot**.  
- MiniStudioGPT devient un environnement de co‚Äëd√©veloppement stable, s√ªr et intelligent.

---

## üîú Prochaine √©tape : v2.0
Mise en place du pipeline CI/CD (d√©ploiement automatique et validation continue) bas√© sur ce socle.
